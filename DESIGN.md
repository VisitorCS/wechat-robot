# 💸 微信记账小助手 - 系统设计文档

> **核心理念：躺着都在收费，站着更得拼命！**

---

## 🎯 设计理念

### 产品定位
**焦虑驱动型记账工具** —— 让用户每天睁眼就感受到"负债压力"，从而激发搬砖动力。

### 核心设计原则

| 原则 | 说明 |
|------|------|
| **痛点可视化** | 每日欠款精确到分，让用户时刻感受"躺着都在花钱" |
| **零成本使用** | 微信原生交互，无需下载APP，随时记账 |
| **极简操作** | 一句话完成记账，降低使用门槛 |
| **社交压力** | 家庭组共享，让欠款"公开透明" |

---

## 📊 现有功能清单

### 记账功能
| 功能 | 指令 | 状态 |
|------|------|------|
| 日常支出 | `支出 50 餐饮 午餐` | ✅ |
| 日常收入 | `收入 1000 工资` | ✅ |
| 添加贷款 | `贷款 房贷 1000000 360` | ✅ |
| 添加负债 | `负债 信用卡分期 12000 12` | ✅ |
| 固定开支 | `固定 物业 200` | ✅ |
| 删除记录 | `删除 1` | ✅ |

### 查询功能
| 功能 | 指令 | 状态 |
|------|------|------|
| 今日统计 | `今日` | ✅ |
| 本月统计 | `本月` | ✅ |
| 欠款明细 | `欠款` | ✅ |

### 推送功能
| 功能 | 说明 | 状态 |
|------|------|------|
| 每日欠款提醒 | 早8点推送"眼睛一睁，欠款xxx元" | ✅ |

---

## 🏗️ 技术架构

```
用户层:     微信公众号
              ↓
应用层:     Flask → 消息处理器 → 定时调度
              ↓
数据层:     SQLite
              ↓
外部服务:   微信API (推送)
```

### 数据模型

```
users (用户表)
├── openid (主键)
├── nickname
└── created_at

expenses (记账记录)
├── id, openid, type
├── amount, category, description
└── created_at

recurring_expenses (固定开支/贷款)
├── id, openid, type, name
├── total_amount, total_months, monthly_amount
└── start_date, end_date, is_active
```

---

## ⚠️ 不足之处分析

### 功能缺陷

| 问题 | 影响 | 优先级 |
|------|------|--------|
| 无法修改记录 | 输错金额需删除重录 | 🔴 高 |
| 无历史查询 | 只能看今日/本月 | 🔴 高 |
| 无分类统计 | 不知道钱花哪了 | 🟡 中 |
| 无预算功能 | 缺少支出控制 | 🟡 中 |
| 无导出功能 | 数据无法备份 | 🟢 低 |

### 用户体验问题

| 问题 | 影响 | 优先级 |
|------|------|--------|
| 指令格式严格 | 容易输错 | 🔴 高 |
| 无撤销操作 | 误删无法恢复 | 🟡 中 |
| 推送时间固定 | 不符合个人作息 | 🟢 低 |

### 技术债务

| 问题 | 影响 | 优先级 |
|------|------|--------|
| SQLite单文件 | 不支持高并发 | 🟡 中 |
| 无日志系统 | 问题难排查 | 🟡 中 |
| 硬编码配置 | 不易维护 | 🟢 低 |

---

## 📋 优化清单

### 短期优化 (1-2周)

- [ ] **模糊指令识别**：支持"花了50块吃饭"等自然语言
- [ ] **修改记录**：`修改 1 金额 100`
- [ ] **自定义推送时间**：`设置 推送时间 7:00`
- [ ] **分类统计**：`统计 餐饮` 或 `统计 本月`

### 中期优化 (1个月)

- [x] **家庭组功能**：共享账本，互相"鞭策"
- [ ] **预算管理**：设置月预算，超支预警
- [ ] **历史查询**：按日期/分类/金额查询
- [ ] **智能提醒**：大额支出预警、还款日提醒

### 长期优化 (3个月)

- [ ] **数据分析**：消费趋势图表
- [ ] **AI记账**：拍照识别账单
- [ ] **多端同步**：小程序/Web版本
- [ ] **数据导出**：Excel/PDF报表

---

## 👨‍👩‍👧‍👦 家庭组功能设计

### 功能概述

让家庭成员共享账本，互相查看欠款情况，形成"社交压力"，激发搬砖动力！

### 指令设计

| 指令 | 功能 | 状态 |
|------|------|
| `创建家庭 我的家` | 创建家庭组 | ✅ |
| `加入家庭 ABC123` | 通过邀请码加入 | ✅ |
| `家庭成员` | 查看成员列表 | ✅ |
| `家庭欠款` | 查看全家欠款排行 | ✅ |
| `退出家庭` | 退出当前家庭组 | ✅ |

### 数据模型扩展

```
families (家庭组)
├── id (主键)
├── name (家庭名称)
├── invite_code (邀请码)
├── creator_openid
└── created_at

family_members (成员关系)
├── id
├── family_id → families.id
├── openid → users.openid
├── nickname (家庭内昵称)
├── role (creator/member)
└── joined_at
```

### 每日推送增强

```
☀️ 早安！眼睛一睁

💸 你今日的收入是：-356.67 元

👨‍👩‍👧‍👦 家庭欠款排行：
🥇 老公：-520.00元/日（房贷+车贷）
🥈 老婆：-200.00元/日（信用卡）
🥉 总计：-720.00元/日

全家每月要还：21,600.00 元
大家一起努力搬砖！💪
```

---

## 🚀 实施计划

### Phase 1: 家庭组基础 (本周)
1. 数据库表设计
2. 创建/加入/退出家庭
3. 家庭成员管理

### Phase 2: 共享功能 (下周)
1. 家庭欠款汇总
2. 成员欠款排行
3. 每日推送增强

### Phase 3: 高级功能 (第三周)
1. 家庭共同支出
2. AA记账
3. 账单分摊
